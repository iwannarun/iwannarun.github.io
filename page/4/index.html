<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="我要稳稳的RUN&#39;s Blog">
<meta property="og:url" content="http://yoursite.com/page/4/index.html">
<meta property="og:site_name" content="我要稳稳的RUN&#39;s Blog">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="我要稳稳的RUN&#39;s Blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/4/"/>





  <title>我要稳稳的RUN's Blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">我要稳稳的RUN's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">I WANNA RUN</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/02/-e5-88-a9-e7-94-a8alfred-workflow-e5-bf-ab-e9-80-9f-e4-b8-8a-e4-bc-a0-e7-b2-98-e8-b4-b4-e6-9d-bf-e5-9b-be-e7-89-87-e8-87-b3-e4-b8-83-e7-89-9b-e5-9b-be/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUN">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://blog.iwannarun.cn/content/images/2017/09/funny.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我要稳稳的RUN's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/02/-e5-88-a9-e7-94-a8alfred-workflow-e5-bf-ab-e9-80-9f-e4-b8-8a-e4-bc-a0-e7-b2-98-e8-b4-b4-e6-9d-bf-e5-9b-be-e7-89-87-e8-87-b3-e4-b8-83-e7-89-9b-e5-9b-be/" itemprop="url">利用Alfred Workflow快速上传粘贴板图片至七牛图床并在Markdown中引用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-02T08:11:29+08:00">
                2016-12-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="应用场景"><a href="#应用场景" class="headerlink" title="应用场景"></a>应用场景</h1><p><img src="http://pic.iwannarun.cn/mdimage9fd4f63a2480e953f0f716e3bdee5a81.png-960.jpg" alt=""> Markdown最大的缺陷就是不能方便的在文章中插入本地图片，所以通常情况下我们需要一个好的图床来帮助我们，国内现在使用体验最佳的图床就是七牛云存储，但是为了插入一张图片我们通常需要做的事情是： 截个图存在桌面 - 打开七牛云存储的网站，上传图片 - 复制图片地址 - 在Markdown中使用<img src="" alt="">语法调用图片插入 - 填写图片地址 - 如果你使用原图保护功能，还需要自己添加样式符 为了一张插入图片，真是心力交瘁。如果插入量巨大，真是不堪重负。所以我们需要使用一个工作流来一键帮我们完成这些复杂的机械化的工作。<strong>本教程实现的目标是</strong>- 截图到粘贴板</p>
<ul>
<li>快捷键插入到Markdown文本 中途甚至不需要任何与编辑文本无关的工作，让你专心写作！</li>
</ul>
<h2 id="教程"><a href="#教程" class="headerlink" title="教程"></a>教程</h2><h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><p> 因为本方法用到了<a href="https://www.alfredapp.com/" target="_blank" rel="external">Alfred</a>的PowerPackage扩展功能，所以你需要首先内（po）购（jie）其高级功能。 然后另一个准备工作就是七牛云存储了，到七牛云存储的官网注册一个账号，开始使用。关于七牛云存储的一些设置，在这里我想说一下： 七牛云存储的设置 在你的空间的数据处理中应该配置好「图片样式」：新建图片样式。 <img src="http://pic.iwannarun.cn/mdimage1faea1a55033443fe73752d18621661a.png-960.jpg" alt=""> 使用图片样式的好处是你可以根据需求插入不同大小的图片，毕竟Markdown是没有图片编辑和调整功能的。我设置了如下的样式： <img src="http://pic.iwannarun.cn/mdimage53ac9eca7eb55299f3370686d2032d94.png-960.jpg" alt=""> 这样我可以通过样式分割符合样式-480.jpg、-960.jpg、-1920.jpg调用不同大小的图片插入到文章中了。 </p>
<h1 id="配置七牛云存储文件同步"><a href="#配置七牛云存储文件同步" class="headerlink" title="配置七牛云存储文件同步"></a>配置七牛云存储文件同步</h1><blockquote>
<p>QRSync是七牛云存储提供的同步上传客户端工具，可以用于Linux、Mac OS X、Windows等操作系统。使用QRSync，可将用户本地某个目录的所有文件同步上传到七牛云存储中，同时支持增量上传，可以只将目录中新增的文件上传至七牛云存储。 首先，下载QRSBox</p>
</blockquote>
<p> Mac OS X: <a href="http://devtools.qiniu.com/qiniu-devtools-darwin_amd64-current.tar.gz" target="_blank" rel="external">qrsynccli darwin_amd64</a> Linux 64bits: <a href="http://devtools.qiniu.com/qiniu-devtools-linux_amd64-current.tar.gz" target="_blank" rel="external">qrsyncli linux_amd64</a> Linux 32bits: <a href="http://devtools.qiniu.com/qiniu-devtools-linux_386-current.tar.gz" target="_blank" rel="external">qrsyncli linux_386</a> 然后在你希望同步的文件夹下创建以下两个目录 <code>CLI</code> ： 用于存放QRSync命令脚本 <code>Data</code> ： 用于存放需要同步的图片、文件等 把下载好的QRSync解压后所有文件放到<code>CLI</code>目录下，在<code>CLI</code>目录下新建<code>conf.json</code>文件包含以下内容： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">    &quot;src&quot;: &quot;/home/your/sync_dir/Data&quot;,</div><div class="line">    &quot;dest&quot;: &quot;qiniu:access_key=&lt;AccessKey&gt;&amp;secret_key=&lt;SecretKey&gt;&amp;bucket=&lt;Bucket&gt;&amp;key_prefix=&lt;KeyPrefix&gt;&quot;,</div><div class="line">    &quot;debug_level&quot;: 1</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p> 其中： <code>src</code>是本地的同步目录<code>Data</code>，该目录下的文件会随时同步上传至七牛云存储。 AccessKey 和 SecretKey 需要在七牛云存储平台上申请 开通七牛开发者帐号 登录七牛开发者平台，查看 <code>Access Key</code> 和 <code>Secret Key``&lt;bucket&gt;&lt;/bucket&gt;</code> 是保存同步文件的资源空间名。 <code>&lt;keyprefix&gt;&lt;/keyprefix&gt;</code> 是文件前缀，可选。如果设置了该参数，那么上传的文件名前都会加上前缀。这个前缀主要用于在空间中区分不同上传来源的文件。 配置完成后，在<code>CLI</code>目录下就可以随时使用如下命令来同步文件夹了： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./qrsync conf.json</div></pre></td></tr></table></figure></p>
<blockquote>
<p>另一个可以使用的工具是<code>QRSBox</code>，其支持后台实时监控目录，当有新文件加入到同步目录的时候，就会自动上传到相应的空间。但截止到我测试时（2016年3月19日）QRSBox仍有一些Bug导致工作流无法工作，所以我选择了更加可靠的QRSync。 配置WorkFlow</p>
</blockquote>
<p> 下面我们来配置WorkFlow工作流来让一切变得自动化起来，首先打开Alfred，进入Workflow，并且创建一个空白的工作流： <img src="http://pic.iwannarun.cn/mdimage4b0c27db3dcb4e397c7a744273507204.png-960.jpg" alt=""> 然后添加一个热键，我选择的是<code>⌘+⇧+V</code>，这样和我的Annotate截屏快捷键<code>⌘+⇧+A</code>正好形成一对： <img src="http://pic.iwannarun.cn/mdimage5930e856f67ec0144dafcccd2998af1b.png-960.jpg" alt=""> 然后添加一个action，选择<code>osascript</code>作为脚本语言 <img src="http://pic.iwannarun.cn/mdimage7c41dd488d71012920101e6f56f21124.png-960.jpg" alt=""> 我们添加如下脚本： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">&lt;br&gt;&lt;/br&gt;property fileTypes : &#123;¬</div><div class="line">    &#123;«class PNGf», &quot;.png&quot;&#125;, ¬</div><div class="line">    &#123;JPEG picture, &quot;.jpg&quot;&#125;&#125;</div><div class="line">on getType()</div><div class="line">    repeat with aType in fileTypes</div><div class="line">        repeat with theInfo in (clipboard info)</div><div class="line">            if (first item of theInfo) is equal to (first item of aType) then return aType</div><div class="line">        end repeat</div><div class="line">    end repeat</div><div class="line">    return missing value</div><div class="line">end getType</div><div class="line">set theType to getType()</div><div class="line">if theType is not missing value then</div><div class="line">    set filePath to &quot;/Users/quentin/Documents/Qiniu/Data/&quot; --这里换成你自己放置图片的路径</div><div class="line">    set fileName to do shell script &quot;date \&quot;+%Y%m%d%H%M%S\&quot; | md5&quot; --用当前时间的md5值做文件名</div><div class="line">    if fileName does not end with (second item of theType) then set fileName to (fileName &amp; second item of theType as text)</div><div class="line">    set markdownUrl to &quot;![](http://7xin49.com1.z0.glb.clouddn.com/&quot; &amp; fileName &amp; &quot;-960.jpg)&quot; --这里是你的七牛域名和设置的图片样式</div><div class="line">    set filePath to filePath &amp; fileName</div><div class="line">    try</div><div class="line">        set imageFile to (open for access filePath with write permission)</div><div class="line">        set eof imageFile to 0</div><div class="line">        write (the clipboard as (first item of theType)) to imageFile</div><div class="line">        close access imageFile</div><div class="line">        set the clipboard to markdownUrl</div><div class="line">        try</div><div class="line">            tell application &quot;System Events&quot;</div><div class="line">                keystroke &quot;v&quot; using command down</div><div class="line">            end tell</div><div class="line">        end try</div><div class="line">        do shell script &quot;/Users/quentin/Documents/Qiniu/CLI/qrsync /Users/quentin/Documents/Qiniu/CLI/conf.json&quot; --此处是你的QRSync脚本目录和命令</div><div class="line">    on error</div><div class="line">        try</div><div class="line">            close access imageFile</div><div class="line">        end try</div><div class="line">        return &quot;&quot;</div><div class="line">    end try</div><div class="line">else</div><div class="line">    return &quot;&quot;</div><div class="line">end if</div></pre></td></tr></table></figure></p>
<p> 代码中有4处需要替换修改地方： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">set filePath to &quot;/Users/quentin/Documents/Qiniu/Data/&quot;</div></pre></td></tr></table></figure></p>
<p> 换成你自己设定的同步目录。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">set markdownUrl to &quot;![](http://7xin49.com1.z0.glb.clouddn.com/&quot; &amp; fileName &amp; &quot;-960.jpg)&quot;</div></pre></td></tr></table></figure></p>
<h1 id="设定成你的七牛空间域名："><a href="#设定成你的七牛空间域名：" class="headerlink" title="设定成你的七牛空间域名："></a>设定成你的七牛空间域名：</h1><p><img src="http://pic.iwannarun.cn/mdimage7df5643dd68e0db02e815c2ad470248b.png-960.jpg" alt=""> 注意如果你在设置QRSync时预设了<keyprefix>前缀，记得在域名后面补上。另外再加上自己设定的图片样式<code>-960.jpg</code>，我在样式中自带了一个统一的文件后缀.jpg是为了让Markdown编辑器知道这是一个图片链接。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">do shell script &quot;/Users/quentin/Documents/Qiniu/CLI/qrsync /Users/quentin/Documents/Qiniu/CLI/conf.json&quot;</div></pre></td></tr></table></figure></keyprefix></p>
<p> 换成你的QRSync的命令脚本目录即可。 然后，添加一个通知，让我们得到上传成功的反馈： <img src="http://pic.iwannarun.cn/mdimage7fba944d86862a60710c663487b56261.png-960.jpg" alt=""> 最后，把Trigger、Action和Notification用线连起来，就大功告成了： <img src="http://pic.iwannarun.cn/mdimage8817d426bba3b26d01a76c48e5ca3fb6.png-960.jpg" alt=""> 现在，你只需要 </p>
<h1 id="额外的同步工作流"><a href="#额外的同步工作流" class="headerlink" title="额外的同步工作流"></a>额外的同步工作流</h1><p> 此外，我再提供一个额外的工作流来负责同步目录到七牛云存储，针对那些直接复制到同步目录下的文件。另建一个Workflow，如图所示： <img src="http://pic.iwannarun.cn/mdimage11927005044c9c098f990d2f234de05b.png-960.jpg" alt=""> 使用你喜欢的HotKey来启动上传，然后使用bash语言键入以下script： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">/Users/quentin/Documents/Qiniu/CLI/qrsync /Users/quentin/Documents/Qiniu/CLI/conf.json</div></pre></td></tr></table></figure></p>
<p> 同样，把相应目录改成你自己的QRSync命令脚本目录就可以了。 <em>注意</em>：当上一个工作流没有成功上传时，可以使用这个工作流再次上传。 </p>
<h2 id="直接下载"><a href="#直接下载" class="headerlink" title="直接下载"></a>直接下载</h2><p> 我把自己写好的WorkFlow上传到百度云了，你也可以自己下载，然后修改参数直接使用，传送门： <a href="http://pan.baidu.com/s/1mhv4qTE" target="_blank" rel="external">百度网盘下载</a> 密码：q3cd 原文连接:<a href="https://www.zybuluo.com/fyywy520/note/317999#额外的同步工作流" target="_blank" rel="external">https://www.zybuluo.com/fyywy520/note/317999#额外的同步工作流</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/12/02/-e6-b5-8b-e8-af-95-e5-9b-be-e7-89-87-e6-b0-b4-e5-8d-b0-e9-85-8d-e7-bd-ae/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUN">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://blog.iwannarun.cn/content/images/2017/09/funny.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我要稳稳的RUN's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/12/02/-e6-b5-8b-e8-af-95-e5-9b-be-e7-89-87-e6-b0-b4-e5-8d-b0-e9-85-8d-e7-bd-ae/" itemprop="url">利用七牛CND配置WordPress博客的静态资源加速</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-02T00:15:23+08:00">
                2016-12-02
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>为了加快访问博客的速度，特意安装了一个七牛云存储的插件，主要用到了静态资源CDN加速和图片镜像到七牛云的功能。最后达到的效果是:后台的媒体资源路径是本博客域名加后缀构成的路径<code>blog.iwannarun.cn/xxx.jpg</code>，而在前台显示则为预设的<code>pic.iwannarun.cn</code>。通过后者访问图片，css和js等静态资源都会被七牛融合CDN加速。</p>
</blockquote>
<h1 id="这里大致记录一下过程："><a href="#这里大致记录一下过程：" class="headerlink" title="这里大致记录一下过程："></a>这里大致记录一下过程：</h1><ol>
<li>从七牛控制台获取A/SKey、对象空间名称以及七牛上绑定的域名填写到指定位置: <img src="http://pic.iwannarun.cn/mdimageb1c9ef446f6ffba46073a8013401886a.png-960.jpg" alt=""></li>
<li>填写博客域名，勾选需要的功能后博客这边就算配置完成了。 <img src="http://pic.iwannarun.cn/mdimage53c1d804f10135b6d6fe733031d1ec06.png-960.jpg" alt=""></li>
<li>再次回到七牛控制台，进行镜像存储配置，对博客上所有新增资源文件同步到七牛云： <img src="http://pic.iwannarun.cn/mdimage83dad00a8f02bf6703a5e5c0d71b7657.png-960.jpg" alt=""></li>
<li>接着配置融合CDN功能，填写静态资源专用域名: <img src="http://pic.iwannarun.cn/mdimageab0f4b0836ba1acded1f422855ec6183.png-960.jpg" alt=""></li>
<li>配置完成后，会提供cname域名： <img src="http://pic.iwannarun.cn/mdimage0294ed68649aabac2f75f330315d2dba.png-960.jpg" alt=""></li>
<li>等待七牛后台刷新后，将返回的cname拿到域名提供方的解析控制台，参考官方提供的方法添加cname记录： <img src="http://pic.iwannarun.cn/mdimagefcb5188b81ebd8be3ca531e56809b6ee.png-960.jpg" alt=""></li>
</ol>
<h1 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h1><ul>
<li>网页源代码的图片路径已经改变： <img src="http://pic.iwannarun.cn/mdimageeceb4654ea13e9143ecffd4d9c7d3296.png-960.jpg" alt=""></li>
<li>网页源代码的JS/CSS也被替换为七牛镜像存储： <img src="http://pic.iwannarun.cn/mdimage5e2272346b948d4389ca573b14731cb7.png-960.jpg" alt=""></li>
<li>在七牛控制台也能够看到CDN流量说明成功了 <img src="http://pic.iwannarun.cn/mdimage9f3ac0bb9d5c98238ad388248c90ce99.png-960.jpg" alt=""></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/30/netty-e9-80-9a-e4-bf-a1-e6-a1-86-e6-9e-b6-e5-ad-a6-e4-b9-a0-e7-ac-94-e8-ae-b0-e4-ba-8c/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUN">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://blog.iwannarun.cn/content/images/2017/09/funny.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我要稳稳的RUN's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/30/netty-e9-80-9a-e4-bf-a1-e6-a1-86-e6-9e-b6-e5-ad-a6-e4-b9-a0-e7-ac-94-e8-ae-b0-e4-ba-8c/" itemprop="url">Netty通信框架学习笔记二</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-30T02:44:57+08:00">
                2016-11-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="期货交易App"><a href="#期货交易App" class="headerlink" title="期货交易App"></a>期货交易App</h1><p> 首先，我们的程序后台作为一个client与CTP（期货行情源）也就是server建立长连接，以事件驱动的方式对接收到的实时行情数据进行持久化（行情数据：买卖价、开收价、持有量等）和业务处理（涉及交易、风控等）。同时地，持久化的数据将在用户使用app（每个用户可以看作一个client）时，被我们持续分发到每个连接通道中，最终被app客户端用作视图渲染，下单操作等。 </p>
<h1 id="客户端启动代码："><a href="#客户端启动代码：" class="headerlink" title="客户端启动代码："></a>客户端启动代码：</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">public class NettyClient&#123;</div><div class="line">public static void connect(NettyHandler handler, int workers, String host, int port) throws Exception &#123;</div><div class="line">    ExecutorService pool= Executors.newFixedThreadPool(Math.max(workers, 1));</div><div class="line">    EventLoopGroup workerGroup = new NioEventLoopGroup(1);</div><div class="line">    try &#123;</div><div class="line">        Bootstrap b = new Bootstrap();</div><div class="line">        b.group(workerGroup).channel(NioSocketChannel.class).handler(new InitHandler(handler, pool));</div><div class="line">        b.connect(host, port).sync().channel().closeFuture().sync();</div><div class="line">&#125; finally &#123;</div><div class="line">    workerGroup.shutdownGracefully();</div><div class="line">    pool.shutdown();</div><div class="line">&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line">public static void main(String[] args) throws Exception &#123;</div><div class="line">new Thread() &#123;</div><div class="line">            public void run() &#123;</div><div class="line">                try &#123;</div><div class="line">                    NettyClient.connect(new MyHandler2(), 1, &quot;127.0.0.1&quot;, 33333);</div><div class="line">                &#125; catch (Exception e) &#123;</div><div class="line">                    e.printStackTrace();</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;.start();</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="服务端启动代码："><a href="#服务端启动代码：" class="headerlink" title="服务端启动代码："></a>服务端启动代码：</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div></pre></td><td class="code"><pre><div class="line">public class NettyServer  &#123;</div><div class="line"> public static void start(NettyHandler handler, int workers, int port) throws Exception &#123;</div><div class="line">        ExecutorService pool=Executors.newFixedThreadPool(Math.max(workers, 1));</div><div class="line">        EventLoopGroup bossGroup = new NioEventLoopGroup(1); // 用于accept incomming连接请求</div><div class="line">        EventLoopGroup workerGroup = new NioEventLoopGroup();// 程序将accepted连接请求注册到workerGroup中，并由里面的线程跟踪处理相关“traffic”</div><div class="line"></div><div class="line">        try &#123;</div><div class="line">            ServerBootstrap b = new ServerBootstrap();</div><div class="line">            b.group(bossGroup, workerGroup).channel(NioServerSocketChannel.class).childHandler(new InitHandler(handler,pool));</div><div class="line">            // 利用 NioServerSocketChannel class 的初始化Server端的Channel实例来accept连接请求</div><div class="line">            // 设置另外一个handler，childHanlder与handler的不同会在后续博文中描述，Handler在Netty是一个很重要的地位，相当于Servlet中的filter一样，这里用一个ChannelInitializer来统一管理所有handler</div><div class="line">            b.bind(port).sync().channel().closeFuture().sync();</div><div class="line">            // 绑定端口，并利用sync()方法开始监听端口（等待客户端连接请求），若成功，返回ChannelFuture，ChannelFuture也会在后续详细说明</div><div class="line">            // 监听服务关闭监听  </div><div class="line">        &#125; finally &#123;</div><div class="line">            bossGroup.shutdownGracefully();// 相当于是关闭线程池  </div><div class="line">            workerGroup.shutdownGracefully();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">public static void main(String[] args) throws Exception &#123;</div><div class="line">        try &#123;</div><div class="line">            NettyServer.start(new NettyHandler() &#123;</div><div class="line">                AtomicInteger ai=new AtomicInteger();</div><div class="line">                @Override</div><div class="line">                public void handleMsg(final Channel channel, String json) &#123;</div><div class="line">                    //System.out.println(ai.incrementAndGet()+&quot; &quot;+System.currentTimeMillis()+&quot; &quot;+json);</div><div class="line">                    System.out.println(&quot;服务端向客户端 输入数据&quot;);&lt;/p&gt;</div><div class="line"></div><div class="line">              Timer time = new Timer();</div><div class="line">                time.schedule(new TimerTask() &#123;</div><div class="line">                    @Override</div><div class="line">                    public void run() &#123;</div><div class="line"></div><div class="line">                        channel.writeAndFlush(&quot;接受数据&quot;+ai.incrementAndGet());</div><div class="line">                    &#125;</div><div class="line">                &#125;,1000l,5000l);</div><div class="line"></div><div class="line">            &#125;</div><div class="line">            @Override</div><div class="line">            public void channelRemoved(Channel channel) &#123;</div><div class="line">                System.out.println(&quot;remove&quot;);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            @Override</div><div class="line">            public void channelRegistered(Channel channel) &#123;</div><div class="line">                channel.writeAndFlush(&quot;初次握手&quot;);</div><div class="line">                System.out.println(&quot;有新的客户端连入&quot;);</div><div class="line">            &#125;</div><div class="line">        &#125;, 16, 33333);</div><div class="line">    &#125; catch (Exception e) &#123;</div><div class="line">        e.printStackTrace();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="NettyHanlder-业务处理核心部分，可监听通道建立、端口以及数据接受事件"><a href="#NettyHanlder-业务处理核心部分，可监听通道建立、端口以及数据接受事件" class="headerlink" title="NettyHanlder:业务处理核心部分，可监听通道建立、端口以及数据接受事件"></a>NettyHanlder:业务处理核心部分，可监听通道建立、端口以及数据接受事件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">public interface NettyHandler &#123;</div><div class="line">    public void channelRegistered(io.netty.channel.Channel channel);</div><div class="line">    public void handleMsg(io.netty.channel.Channel channel, String json);</div><div class="line">    public void channelRemoved(io.netty.channel.Channel channel);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="InitHandler-通过封装使得Client与Server可以共用一个ChannelInitializer"><a href="#InitHandler-通过封装使得Client与Server可以共用一个ChannelInitializer" class="headerlink" title="InitHandler:通过封装使得Client与Server可以共用一个ChannelInitializer"></a>InitHandler:通过封装使得Client与Server可以共用一个ChannelInitializer</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">&lt;br&gt;&lt;/br&gt;/**</div><div class="line"> * 描述:ChannelInitializer的主要目的是为SocketChannel注册Handler的主要目的是为SocketChannel注册Handler，</div><div class="line"> * 也就是当一个SocketChannel被Server accept 进来以后，进来的数据要分别按注册先后顺序执行哪些handler，</div><div class="line"> * 出去的数据要分别按逆序的顺序执行哪些handler</div><div class="line"> *</div><div class="line"> * @author 陈润发</div><div class="line"> * @created 16/9/3</div><div class="line"> * @since v1.0.0</div><div class="line"> */</div><div class="line">@Component</div><div class="line">public class InitHandler extends ChannelInitializer&lt;SocketChannel&gt; &#123;</div><div class="line">    private final static int readerIdleTimeSeconds = 40;//读操作空闲30秒</div><div class="line">    private final static int writerIdleTimeSeconds = 50;//写操作空闲60秒</div><div class="line">    private final static int allIdleTimeSeconds = 100;//读写全部空闲100秒</div><div class="line">    NettyHandler handler;</div><div class="line">    ExecutorService pool;</div><div class="line"></div><div class="line">    public InitHandler(NettyHandler handler,ExecutorService worker)&#123;</div><div class="line">        this.handler=handler;</div><div class="line">        pool=worker;</div><div class="line">    &#125;</div><div class="line">    private SimpleChannelInboundHandler&lt;String&gt; coreHandler=new SimpleChannelInboundHandler&lt;String&gt;()&#123;</div><div class="line">        public void channelActive(ChannelHandlerContext ctx) throws Exception &#123;</div><div class="line"></div><div class="line">            handler.channelRegistered(ctx.channel());</div><div class="line"></div><div class="line">        &#125;;</div><div class="line">        @Override</div><div class="line">        protected void channelRead0(final ChannelHandlerContext ctx, final String msg) throws Exception &#123;</div><div class="line"></div><div class="line">            pool.execute(new Runnable() &#123;</div><div class="line"></div><div class="line">                @Override</div><div class="line">                public void run() &#123;</div><div class="line"></div><div class="line">                    handler.handleMsg(ctx.channel(), msg);</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">        &#125;</div><div class="line">        public void channelInactive(ChannelHandlerContext ctx) throws Exception &#123;</div><div class="line">            handler.channelRemoved(ctx.channel());</div><div class="line">        &#125;;</div><div class="line">        public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception &#123;</div><div class="line">            ctx.close();</div><div class="line">            cause.printStackTrace();</div><div class="line">            handler.channelRemoved(ctx.channel());</div><div class="line">        &#125;;</div><div class="line">        public boolean isSharable() &#123;</div><div class="line">            return true;</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line">    @Override</div><div class="line">    protected void initChannel(SocketChannel ch) throws Exception &#123;</div><div class="line">        ChannelPipeline pipeline = ch.pipeline();</div><div class="line">        //ChannelInboundHandler都是按顺序执行的，ChanneloutboundHandler都是按逆序：</div><div class="line">        pipeline.addLast(new LuckinDecoder()); //继承至ChannelInboundHandlerAdapter</div><div class="line">        pipeline.addLast(new LuckinEncoder()); //继承至ChannelOutboundHandlerAdapter</div><div class="line">        pipeline.addLast(coreHandler); //继承至ChannelInboundHandlerAdapter</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="LuckinEecoder：数据解码，同时可做数据舍弃，如接受到的数据小于4个字节认为无效数据"><a href="#LuckinEecoder：数据解码，同时可做数据舍弃，如接受到的数据小于4个字节认为无效数据" class="headerlink" title="LuckinEecoder：数据解码，同时可做数据舍弃，如接受到的数据小于4个字节认为无效数据"></a>LuckinEecoder：数据解码，同时可做数据舍弃，如接受到的数据小于4个字节认为无效数据</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&lt;br&gt;&lt;/br&gt;public class LuckinDecoder extends ByteToMessageDecoder &#123;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void decode(ChannelHandlerContext ctx, ByteBuf in, List&lt;Object&gt; out) throws Exception &#123;</div><div class="line"></div><div class="line">        while (true) &#123;</div><div class="line">            if (in.readableBytes() &lt;= 4) &#123;</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">            in.markReaderIndex();</div><div class="line">            int length = in.readInt();</div><div class="line">            if(length&lt;=0)&#123;</div><div class="line">                throw new Exception(&quot;a negative length occurd while decode!&quot;);</div><div class="line">            &#125;</div><div class="line">            if (in.readableBytes() &lt; length) &#123;</div><div class="line">                in.resetReaderIndex();</div><div class="line">                break;</div><div class="line">            &#125;</div><div class="line">            byte[] msg = new byte[length];</div><div class="line">            in.readBytes(msg);</div><div class="line">            out.add(new String(msg, &quot;GBK&quot;));</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="LuckinEncoder-对数据编码"><a href="#LuckinEncoder-对数据编码" class="headerlink" title="LuckinEncoder:对数据编码"></a>LuckinEncoder:对数据编码</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public class LuckinEncoder extends MessageToByteEncoder&lt;String&gt; &#123;</div><div class="line">    @Override</div><div class="line">    protected void encode(ChannelHandlerContext ctx, String msg, ByteBuf out) throws Exception &#123;</div><div class="line">//      System.out.println(&quot;begin encode&quot;);</div><div class="line">        if(StringUtils.isEmpty(msg))&#123;</div><div class="line">            return ;</div><div class="line">        &#125;</div><div class="line">        byte[] message=msg.getBytes(&quot;GBK&quot;);</div><div class="line">        out.writeInt(message.length);</div><div class="line">        out.writeBytes(message);</div><div class="line"></div><div class="line">//      System.out.println(&quot;end encode&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><code>分析</code> 对于Server，适配的结果：LuckinEecoder -&gt; (CTP接受后进行Decoder) 对于Client，适配的结果：LuckinDecoder -&gt; CoreHandler - - - - - -</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/30/netty-e9-80-9a-e4-bf-a1-e6-a1-86-e6-9e-b6-e5-ad-a6-e4-b9-a0-e7-ac-94-e8-ae-b0-e4-b8-80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUN">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://blog.iwannarun.cn/content/images/2017/09/funny.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我要稳稳的RUN's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/30/netty-e9-80-9a-e4-bf-a1-e6-a1-86-e6-9e-b6-e5-ad-a6-e4-b9-a0-e7-ac-94-e8-ae-b0-e4-b8-80/" itemprop="url">Netty通信框架学习笔记一</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-30T02:04:00+08:00">
                2016-11-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>引用官方的介绍：Netty是一款异步以事件为驱动的网络开发框架和工具，能够快速的帮助开发者开发出可维护的高性能，高扩张性的服务器和客户端。换句话说，Netty是一款可以快速和方便的开发出服务器和客户端应用的NIO框架。它使得开发TCP, UDP服务应用变得非常方便。快速和简单并不会影响应用的性能和可维护性。Netty采用的精心的设计并且实现很多协议例如FTP, SMTP, HTTP 各种二进制数据和文本协议。结果,Netty在性能，稳定性，灵活性上都做得非常好。 网上：Netty是一套在java NIO的基础上封装的便于用户开发网络应用程序的api. 应用场景很多,诸如阿里的消息队列(RocketMQ),分布式rpc(Dubbo)通信层都使用到了netty(dubbo可以用服务发现自由选择通信层)。</p>
</blockquote>
<p> 到XHB已经四个多月了，之前一直在YQB组做期货交易软件相关的开发，用到了Netty（4.0）这个网络通信框架，一直想找机会整理这部分相关的笔记，于是有了开篇。 </p>
<h1 id="Netty中的组件"><a href="#Netty中的组件" class="headerlink" title="Netty中的组件"></a>Netty中的组件</h1><ul>
<li>Boss:启动一个server实例只会产生一个boss线程，boss线程主要负责监听端口。</li>
<li>Worker:当有新的连接请求时boss就会产生一个task交给worker线程池处 理，worker线程池中线程的个数默认是cpu个数的2倍,不负责处理业务逻辑，只是起到分发请求到handler的作用。</li>
<li>ChannelPipelineFactory：产生ChannelPipe的工厂类。</li>
<li>Channel:负责数据读，写的对象，有点类似于老的io里面的stream。它和stream的区别，channel是双向的，既可以write 也可以read，而stream要分outstream和inputstream。而且在NIO中用户不应该直接从channel中读写数据，而是应该通过buffer，通过buffer再将数据读写到channel中。同事提供了许多通道信息，如：状态、ChannelConfig。</li>
<li>ChannelEvent:是数据或者状态的载体，若是以server为主体的话，从client的数据到server的过程是Upstream；而server到client的数据传输过程叫downstream；而如果以client为主体的话，从server到client的过程对client来说是Upstream，而client到server的过程对client来说就是downstream。</li>
<li>Pipeline:负责维护所有的Handler。</li>
<li>ChannelPipeline:ChannelHandler的容器,一个Channel包含一个ChannelPipeline，所有ChannelHandler都会注册到ChannelPipeline中，并按顺序组织起来。</li>
<li>ChannelContext:一个Channel一个，是Handler和Pipeline的中间件。</li>
<li>ChannelHandler:对Channel事件的处理器，可分两类ChannelInboundHandler和ChannelOutboundHandler。</li>
<li>Sink:负责和底层的交互如bind，Write，Close等。</li>
</ul>
<h1 id="几个图示"><a href="#几个图示" class="headerlink" title="几个图示"></a>几个图示</h1><p><strong>ChannelPipeline</strong><img src="http://blog.iwannarun.cn/wp-content/uploads/2016/11/markdown-47448bd848052bf81f9a94711c7b309e.png-960.jpg" alt=""><strong>线程模型</strong><img src="http://blog.iwannarun.cn/wp-content/uploads/2016/11/markdown-0a2ac78cc03042a6f7d1251b4a76d55d.png-960.jpg" alt=""></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/24/maven-e9-80-9a-e8-bf-87profile-e6-9e-84-e5-bb-ba-e4-b8-8d-e5-90-8c-e7-8e-af-e5-a2-83-e9-85-8d-e7-bd-ae-e5-8c-85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUN">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://blog.iwannarun.cn/content/images/2017/09/funny.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我要稳稳的RUN's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/24/maven-e9-80-9a-e8-bf-87profile-e6-9e-84-e5-bb-ba-e4-b8-8d-e5-90-8c-e7-8e-af-e5-a2-83-e9-85-8d-e7-bd-ae-e5-8c-85/" itemprop="url">Maven通过profile构建不同环境配置包</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-24T21:10:32+08:00">
                2016-11-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>一个项目里总会有很多配置文件。而且一般都会有多套环境。开发的、测试的、预上线、正式的。而在这些环境的配置都不太一样。比如数据库、redis等，这些都是很常见的。所以在打包的时候就需要根据不同的环境打包。</p>
</blockquote>
<p> 下面讲的就是利用Maven为不同环境建立不同的环境包，下面是我的目录结构图: <img src="http://o6qknsods.bkt.clouddn.com/markdown-a9294e14a421c4fef114c36b3c7cf182.png-960.jpg" alt=""> 在一个标准的maven项目<code>rescourse</code>目录下添加了一个<code>config</code>目录，<code>config</code>目录中有<code>develop</code>和<code>product</code>等多个个目录。分别代表开发和生产环境（当然你可以自行添加更多配置目录） 然后在pom.xml中添加下面的xml： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line">&lt;profiles&gt;</div><div class="line">    &lt;!-- 默认激活 dev 开发环境 --&gt;</div><div class="line">    &lt;!-- product使用 mvn xxx -P product --&gt;</div><div class="line">   &lt;profiles&gt;</div><div class="line">        &lt;profile&gt;</div><div class="line">            &lt;id&gt;develop&lt;/id&gt;</div><div class="line">                        &lt;activation&gt;</div><div class="line">                &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;</div><div class="line">            &lt;/activation&gt;</div><div class="line">            &lt;properties&gt;</div><div class="line">                &lt;cfg_dir&gt;develop&lt;/cfg_dir&gt;</div><div class="line">            &lt;/properties&gt;</div><div class="line">            &lt;build&gt;</div><div class="line">                   &lt;resources&gt;</div><div class="line">                   &lt;resource&gt;</div><div class="line">                    &lt;directory&gt;$&#123;basedir&#125;/src/main/resources&lt;/directory&gt;</div><div class="line">                    &lt;filtering&gt;true&lt;/filtering&gt;</div><div class="line">                                       &lt;!-- 排除resource下所有文件--&gt;</div><div class="line">                            &lt;excludes&gt;</div><div class="line">                                   &lt;exclude&gt;**&lt;/exclude&gt;</div><div class="line">                                &lt;/excludes&gt;</div><div class="line">                                   &lt;/resource&gt;</div><div class="line">                       &lt;resource&gt;</div><div class="line">                    &lt;directory&gt;src/main/java&lt;/directory&gt;</div><div class="line">                                               &lt;!-- 保留指定路径下的指定后缀文件--&gt;</div><div class="line">                        &lt;includes&gt;</div><div class="line">                            &lt;include&gt;**/*.properties&lt;/include&gt;</div><div class="line">                            &lt;include&gt;**/*.xml&lt;/include&gt;</div><div class="line">                        &lt;/includes&gt;</div><div class="line">                     &lt;/resource&gt;</div><div class="line">                &lt;/resources&gt;</div><div class="line">            &lt;/build&gt;</div><div class="line">        &lt;/profile&gt;</div><div class="line">        &lt;profile&gt;</div><div class="line">            &lt;id&gt;product&lt;/id&gt;</div><div class="line">            &lt;activation&gt;</div><div class="line">                &lt;activeByDefault&gt;true&lt;/activeByDefault&gt;</div><div class="line">            &lt;/activation&gt;</div><div class="line">            &lt;properties&gt;</div><div class="line">                &lt;cfg_dir&gt;product&lt;/cfg_dir&gt;</div><div class="line">            &lt;/properties&gt;</div><div class="line"></div><div class="line">        &lt;/profile&gt;</div><div class="line">&lt;/profiles&gt;</div></pre></td></tr></table></figure>
<p> 有时候我们希望打包的时候指定为jar包以减小空间，就应该将这些区分用途的配置信息过滤掉，只保留必要的如<code>*.xml</code>和<code>.properties</code>文件， 则可以通过<code>resource</code>标签达到我们的需求。 <strong>注意：</strong>如果是开源的项目，那么应该将product的所以相关文件通过<code>.gitignore</code>文件进行了排除，这样避免私密配置暴露。 </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/21/nxlog-e5-ae-89-e8-a3-85-e5-8f-8a-e4-bd-bf-e7-94-a8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUN">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://blog.iwannarun.cn/content/images/2017/09/funny.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我要稳稳的RUN's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/21/nxlog-e5-ae-89-e8-a3-85-e5-8f-8a-e4-bd-bf-e7-94-a8/" itemprop="url">Nxlog安装及使用</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-21T20:22:56+08:00">
                2016-11-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="安装Nxlog"><a href="#安装Nxlog" class="headerlink" title="安装Nxlog"></a>安装Nxlog</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">1.wget http://nxlog.org/system/files/products/files/1/nxlog-ce-2.9.1716-1_rhel7.x86_64.rpm</div><div class="line">2.yum localinstall nxlog-ce-2.9.1716-1_rhel7.x86_64.rpm -y</div></pre></td></tr></table></figure>
<h1 id="配置nxlog-conf"><a href="#配置nxlog-conf" class="headerlink" title="配置nxlog.conf"></a>配置nxlog.conf</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line">## This is a sample configuration file. See the nxlog reference manual about the</div><div class="line">## configuration options. It should be installed locally under</div><div class="line">## /usr/share/doc/nxlog-ce/ and is also available online at</div><div class="line">## http://nxlog.org/docs</div><div class="line"></div><div class="line">########################################</div><div class="line"># Global directives                    #</div><div class="line">########################################</div><div class="line">User nxlog</div><div class="line">Group nxlog</div><div class="line"></div><div class="line">LogFile /var/log/nxlog/nxlog.log</div><div class="line">LogLevel INFO</div><div class="line"></div><div class="line">########################################</div><div class="line"># Modules                              #</div><div class="line">########################################</div><div class="line">#&lt;Extension _syslog&gt;</div><div class="line"> #   Module      xm_syslog</div><div class="line">#&lt;/Extension&gt;</div><div class="line"></div><div class="line">&lt;Input in1&gt;</div><div class="line">    Module      im_file</div><div class="line">    File  &quot;/data/server/logs/admin/admin.log&quot;</div><div class="line">    SavePos  TRUE</div><div class="line">&lt;/Input&gt;</div><div class="line"></div><div class="line">&lt;Input in2&gt;</div><div class="line">    Module      im_file</div><div class="line">    File   &quot;/data/stock_server/log/stock_futuresquota/futuresquota.log&quot;</div><div class="line">    SavePos  TRUE</div><div class="line">&lt;/Input&gt;</div><div class="line"></div><div class="line">&lt;Output out&gt;</div><div class="line">    Module      om_udp</div><div class="line">    Host xxx.xxx.xxx(graylog)</div><div class="line">    Port 12601（需要与graylog约定的输入源配置一致）</div><div class="line">&lt;/Output&gt;</div><div class="line"></div><div class="line"></div><div class="line">########################################</div><div class="line"># Routes                               #</div><div class="line">########################################</div><div class="line">&lt;Route 1&gt;</div><div class="line">    Path        in1 =&gt; out</div><div class="line">&lt;/Route&gt;</div><div class="line"></div><div class="line">&lt;Route 2&gt;</div><div class="line">    Path        in2 =&gt; out</div><div class="line">&lt;/Route&gt;</div><div class="line"></div><div class="line">~</div><div class="line">~</div><div class="line">~</div></pre></td></tr></table></figure>
<h1 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service nxlog start</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/12/centos-6-8-e5-92-8c7-x-docker-e7-9a-84-e5-ae-89-e8-a3-85-e6-96-b9-e5-bc-8f/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUN">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://blog.iwannarun.cn/content/images/2017/09/funny.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我要稳稳的RUN's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/12/centos-6-8-e5-92-8c7-x-docker-e7-9a-84-e5-ae-89-e8-a3-85-e6-96-b9-e5-bc-8f/" itemprop="url">CentOS 6.8和7.x Docker的安装方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-12T21:39:01+08:00">
                2016-11-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="在CentOS6-8下安装Docker"><a href="#在CentOS6-8下安装Docker" class="headerlink" title="在CentOS6.8下安装Docker"></a>在CentOS6.8下安装Docker</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@bogon yum.repos.d]# uname -a</div><div class="line">Linux bogon 2.6.32-642.el6.x86_64 #1 SMP Tue May 10 17:27:01 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux</div><div class="line">[root@bogon yum.repos.d]# cat /etc/redhat-release </div><div class="line">CentOS release 6.8 (Final)</div></pre></td></tr></table></figure>
<p> 安装EPEL 因为系统自带的repo中不带docker需要安装epel <code>rpm -Uvh http://ftp.riken.jp/Linux/fedora/epel/6Server/x86_64/epel-release-6-8.noarch.rpm</code> 安装Docker <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">yum install -y docker-io</div></pre></td></tr></table></figure></p>
<p> 开机自启动与启动Docker <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[root@bogon yum.repos.d]# service docker start</div><div class="line">Starting cgconfig service:                                 [  OK  ]</div><div class="line">Starting docker:                                       [  OK  ]</div><div class="line">[root@bogon yum.repos.d]# chkconfig docker on</div><div class="line">[root@bogon yum.repos.d]# chkconfig docker --list</div><div class="line">docker          0:off   1:off   2:on    3:on    4:on    5:on    6:off</div><div class="line">[root@bogon yum.repos.d]#</div></pre></td></tr></table></figure></p>
<h2 id="CentOS-7-x-系列安装-Docker"><a href="#CentOS-7-x-系列安装-Docker" class="headerlink" title="CentOS 7.x 系列安装 Docker"></a>CentOS 7.x 系列安装 Docker</h2><ul>
<li>系统要求：64 位操作系统，内核版本至少为 3.10。</li>
<li>Docker 目前支持 CentOS 6.5 及以后的版本，推荐使用 CentOS 7 系统。</li>
</ul>
<p>首先，添加 yum 软件源。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">$ sudo tee /etc/yum.repos.d/docker.repo &lt;&lt;-&apos;EOF&apos;</div><div class="line">[dockerrepo]</div><div class="line">name=Docker Repository</div><div class="line">baseurl=https://yum.dockerproject.org/repo/main/centos/$releasever/</div><div class="line">enabled=1</div><div class="line">gpgcheck=1</div><div class="line">gpgkey=https://yum.dockerproject.org/gpg</div><div class="line">EOF</div></pre></td></tr></table></figure>
<p> 接着更新 yum 软件源缓存，并安装 docker-engine。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$ sudo yum update</div><div class="line">$ sudo yum install -y docker-engine</div></pre></td></tr></table></figure></p>
<p> 另外，也可以使用官方提供的脚本来安装 Docker。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo curl -sSL https://get.docker.com/ | sh</div></pre></td></tr></table></figure></p>
<p> 最后配置让 Docker 服务在系统启动后自动启动。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ sudo chkconfig docker on</div></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/11/12/jenkins-e5-9c-a8mac-e4-b8-8a-e7-9a-84-e6-9c-8d-e5-8a-a1-e5-90-af-e5-8a-a8-e5-85-b3-e9-97-ad/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUN">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://blog.iwannarun.cn/content/images/2017/09/funny.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我要稳稳的RUN's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/11/12/jenkins-e5-9c-a8mac-e4-b8-8a-e7-9a-84-e6-9c-8d-e5-8a-a1-e5-90-af-e5-8a-a8-e5-85-b3-e9-97-ad/" itemprop="url">Jenkins在Mac上的服务启动&关闭</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-11-12T21:31:46+08:00">
                2016-11-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>#启动<br><code>sudo launchctl load /Library/LaunchDaemons/org.jenkins-ci.plist</code> </p>
<p>#停止<br> <code>sudo launchctl unload /Library/LaunchDaemons/org.jenkins-ci.plist</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/10/21/timer-schedule-e8-bf-90-e8-a1-8c-e4-b8-80-e6-ae-b5-e6-97-b6-e9-97-b4-e8-87-aa-e5-8a-a8-e5-81-9c-e6-ad-a2-e7-9a-84-e5-8f-af-e8-83-bd-e5-8e-9f-e5-9b-a0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUN">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://blog.iwannarun.cn/content/images/2017/09/funny.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我要稳稳的RUN's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/10/21/timer-schedule-e8-bf-90-e8-a1-8c-e4-b8-80-e6-ae-b5-e6-97-b6-e9-97-b4-e8-87-aa-e5-8a-a8-e5-81-9c-e6-ad-a2-e7-9a-84-e5-8f-af-e8-83-bd-e5-8e-9f-e5-9b-a0/" itemprop="url">timer.schedule()运行一段时间自动停止的可能原因</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-10-21T19:39:45+08:00">
                2016-10-21
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><img src="http://o6qknsods.bkt.clouddn.com/markdown-8149edf5db6109be8de56d073d09e0c6.png-960.jpg" alt=""></p>
<h2 id="场景："><a href="#场景：" class="headerlink" title="场景："></a>场景：</h2><p> 在一个定时将mongo里的k线数据更新到内存变量的task中，可能会因为run()方法内的某些异常未进行捕获导致task停止 </p>
<h2 id="解决方案："><a href="#解决方案：" class="headerlink" title="解决方案："></a>解决方案：</h2><ul>
<li>将可能产生异常的代码try catch一下;</li>
<li>使用ScheduledThreadPoolExecutor代替，<code>如果有异常，用ScheduledThreadPoolExecutor还是不会继续执行的，只不过因为线程池的存在，程序不会结束。Timer和ScheduleExecutorService的区别在于一个单线程一个多线程</code>。</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2016/09/12/jenkins-e5-ae-89-e8-a3-85-e6-96-b9-e5-bc-8f-e4-bb-8b-e7-bb-8d/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="RUN">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="http://blog.iwannarun.cn/content/images/2017/09/funny.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="我要稳稳的RUN's Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2016/09/12/jenkins-e5-ae-89-e8-a3-85-e6-96-b9-e5-bc-8f-e4-bb-8b-e7-bb-8d/" itemprop="url">Jenkins基于docker的安装方式</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-09-12T20:56:55+08:00">
                2016-09-12
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="Jenkins安装的方式大概分为三种："><a href="#Jenkins安装的方式大概分为三种：" class="headerlink" title="Jenkins安装的方式大概分为三种："></a>Jenkins安装的方式大概分为三种：</h3><ol>
<li>通过Tomcat运行，将官网下载的<a href="https://jenkins.io/index.html" target="_blank" rel="external">最新版jenkins</a> WAR文件直接放到Tomcat的webaps目录运行即可。</li>
<li>在Mac上进行可以直接下载<a href="https://jenkins.io/content/thank-you-downloading-os-x-installer#stable" target="_blank" rel="external">pkg文件</a>安装。前两种方式均通过访问<a href="http://localhost:8080进入Jenkins的可视化管理界面。ps:境外网站的原因下载缓慢，建议以wget的方式下载，保证文件完整性。" target="_blank" rel="external">http://localhost:8080进入Jenkins的可视化管理界面。ps:境外网站的原因下载缓慢，建议以wget的方式下载，保证文件完整性。</a></li>
<li>Docker的方式：将jenkins运行在容器当中 。（推荐）</li>
</ol>
<h3 id="Docker方式的安装过程："><a href="#Docker方式的安装过程：" class="headerlink" title="Docker方式的安装过程："></a>Docker方式的安装过程：</h3><p> 通过官方镜像源拉取镜像：<code>https://hub.docker.com/_/jenkins/</code>，由于拉取速度实在太慢的原因，不推荐。 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run --name myjenkins -d -p 8080:8080 -v /var/jenkins_home jenkins</div></pre></td></tr></table></figure></p>
<p> 参数不详细解释，详情见 <a href="https://yeasy.gitbooks.io/docker_practice" target="_blank" rel="external">docker常用命令及入门教程</a> 相对较快的另一种方法，采取通过官方jenkins源码构建镜像的方式,首先拉取源码： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/jenkinsci/docker.git</div></pre></td></tr></table></figure></p>
<p> 然后build+Dockerfile构建jenkins镜像 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker build -t xhuabu/jenkins .</div></pre></td></tr></table></figure></p>
<p> 镜像构建成功后（总共21个Step，Dockerfile共21条指令），使用docker images查看镜像， <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker images</div></pre></td></tr></table></figure></p>
<p> 后台跑起容器，同时指定日志配置文件及挂载目录： <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mkdir data</div><div class="line">cat &gt; data/log.properties &lt;&lt;EOF</div><div class="line">handlers=java.util.logging.ConsoleHandler</div><div class="line">jenkins.level=FINEST</div><div class="line">java.util.logging.ConsoleHandler.level=FINEST</div><div class="line">EOF</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">docker run --name myjenkins -d  -p 8080:8080 -p 50000:50000 --env JAVA_OPTS=&quot;-Djava.util.logging.config.file=/var/jenkins_home/log.properties&quot; -v `pwd`/data:/var/jenkins_home jenkins</div></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/5/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="http://blog.iwannarun.cn/content/images/2017/09/funny.gif"
                alt="RUN" />
            
              <p class="site-author-name" itemprop="name">RUN</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">51</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">32</span>
                  <span class="site-state-item-name">标签</span>
                
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/iwannarun" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-globe"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://weibo.com/tromsos" target="_blank" title="Weibo">
                    
                      <i class="fa fa-fw fa-globe"></i>Weibo</a>
                </span>
              
            
          </div>

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-globe"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="http://iwannarun.cn/" title="Iwannarun" target="_blank">Iwannarun</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2015 &mdash; <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">RUN</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Mist</a> v5.1.3</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  







  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>

  
  <script type="text/javascript" src="/lib/three/three.min.js"></script>

  
  <script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  








  





  

  

  

  

  

  

</body>
</html>
